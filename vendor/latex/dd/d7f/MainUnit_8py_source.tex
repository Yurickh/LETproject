\hypertarget{MainUnit_8py}{\subsection{Main\-Unit.\-py}
\label{MainUnit_8py}\index{E\-L\-O/\-E\-L\-O/\-Main\-Unit.\-py@{E\-L\-O/\-E\-L\-O/\-Main\-Unit.\-py}}
}

\begin{DoxyCode}
\hypertarget{MainUnit_8py_source_l00001}{}\hyperlink{namespaceELO_1_1MainUnit}{00001} \textcolor{comment}{#coding: utf-8}
00002 
00003 \textcolor{comment}{## @file MainUnit.py}
00004 \textcolor{comment}{#   Arquivo responsável pela devida execução e estruturação do programa.}
00005 \textcolor{comment}{#}
00006 \textcolor{comment}{#   Aqui reside a Factory, a classe que deve montar a estrutura do resto}
00007 \textcolor{comment}{#   do programa, para que ele execute da forma correta, bem como outros}
00008 \textcolor{comment}{#   blocos fundamentais para o funcionamento do sistema como um todo.}
00009 
00010 \textcolor{keyword}{from} abc \textcolor{keyword}{import} *
00011 
00012 \textcolor{keyword}{from} \hyperlink{namespaceLogin_1_1LoginUnit}{Login.LoginUnit} \textcolor{keyword}{import} *
00013 \textcolor{keyword}{from} \hyperlink{namespaceProfile_1_1ProfileUnit}{Profile.ProfileUnit} \textcolor{keyword}{import} *
00014 \textcolor{keyword}{from} \hyperlink{namespaceAdm_1_1AdmUnit}{Adm.AdmUnit} \textcolor{keyword}{import} *
00015 \textcolor{keyword}{from} \hyperlink{namespaceCourse_1_1CourseUnit}{Course.CourseUnit} \textcolor{keyword}{import} *
00016 
00017 \textcolor{keyword}{import} \hyperlink{namespaceELO_1_1locale_1_1index}{ELO.locale.index} \textcolor{keyword}{as} lang
00018 
00019 \textcolor{keyword}{from} models \textcolor{keyword}{import} Adm, Professor, Student, God
00020 
00021 \textcolor{keyword}{from} django.core.exceptions \textcolor{keyword}{import} PermissionDenied
00022 \textcolor{keyword}{from} django.http \textcolor{keyword}{import} Http404
00023 \textcolor{keyword}{from} django.views.decorators.vary \textcolor{keyword}{import} vary\_on\_cookie
00024 \textcolor{keyword}{from} django.views.decorators.csrf \textcolor{keyword}{import} csrf\_protect
00025 \textcolor{keyword}{from} django.utils.decorators \textcolor{keyword}{import} method\_decorator
00026 \textcolor{keyword}{from} django.utils \textcolor{keyword}{import} translation
00027 
00028 \textcolor{comment}{## Insere os objetos user e DICT em todas as renderizações de template.}
\hypertarget{MainUnit_8py_source_l00029}{}\hyperlink{namespaceELO_1_1MainUnit_a021ebb0ec94aea9dca4014a7218ec38d}{00029} \textcolor{keyword}{def }\hyperlink{namespaceELO_1_1MainUnit_a021ebb0ec94aea9dca4014a7218ec38d}{globalContext}(request):
00030     \_sess = request.session
00031     \textcolor{keywordflow}{return} \{
00032             \textcolor{stringliteral}{'user'}: \_sess[\textcolor{stringliteral}{'user'}] \textcolor{keywordflow}{if} (\textcolor{stringliteral}{'user'} \textcolor{keywordflow}{in} \_sess.keys()) \textcolor{keywordflow}{else} \textcolor{keyword}{False},
00033             \textcolor{stringliteral}{'DICT'}: lang.DICT,
00034         \}
00035 
00036 \textcolor{comment}{## Classe factory.}
00037 \textcolor{comment}{#   Responsável pela construção e controle de fluxo de todo o programa. }
00038 \textcolor{comment}{#   Tudo é criado a partir dela.}
\hypertarget{MainUnit_8py_source_l00039}{}\hyperlink{classELO_1_1MainUnit_1_1Factory}{00039} \textcolor{keyword}{class }\hyperlink{classELO_1_1MainUnit_1_1Factory}{Factory}:
00040     \_\_ui = \textcolor{keywordtype}{None}
00041     \_\_bus = \textcolor{keywordtype}{None}
00042     \_\_pers = \textcolor{keywordtype}{None}
00043 
00044     \textcolor{comment}{## Classe que redireciona para a devida home.}
00045     \textcolor{comment}{#   Caso o usuário já esteja devidamente logado, redireciona para o}
00046     \textcolor{comment}{#   profile, caso contrário, vai para a página de login.}
00047     @method\_decorator(vary\_on\_cookie)
00048     @method\_decorator(csrf\_protect)
\hypertarget{MainUnit_8py_source_l00049}{}\hyperlink{classELO_1_1MainUnit_1_1Factory_a766943202ba781821cf749ca0fb133ba}{00049}     \textcolor{keyword}{def }\hyperlink{classELO_1_1MainUnit_1_1Factory_a766943202ba781821cf749ca0fb133ba}{runHome}(self, request, entity):
00050         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'user'} \textcolor{keywordflow}{in} request.session.keys():
00051             \textcolor{keywordflow}{if} (request.session[\textcolor{stringliteral}{'user'}][\textcolor{stringliteral}{'type'}] == \textcolor{stringliteral}{"Adm"} \textcolor{keywordflow}{or} 
00052                request.session[\textcolor{stringliteral}{'user'}][\textcolor{stringliteral}{'type'}] == \textcolor{stringliteral}{"God"}):
00053                 \textcolor{keywordflow}{return} self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a533b402a54bf6f6715824a8687fa7a24}{runAdm}(request)
00054             \textcolor{keywordflow}{else}:
00055                 \textcolor{keywordflow}{return} self.\hyperlink{classELO_1_1MainUnit_1_1Factory_ab20a76f74180fc77c6b8fcd8de7942f1}{runProfile}(request, acctype=\textcolor{stringliteral}{'Home'})
00056         \textcolor{keywordflow}{else}:
00057             \textcolor{keywordflow}{return} self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a515d1ff460a335b750e58e0cbddf20ae}{runLogin}(request, entity)
00058 
00059     \textcolor{comment}{## Classe que executa o módulo de login.}
00060     \textcolor{comment}{#   Define as camadas de persistência, negócio de login e}
00061     \textcolor{comment}{#   apresentação e verifica o tipo de usuário.}
00062     @method\_decorator(vary\_on\_cookie)
00063     @method\_decorator(csrf\_protect)
\hypertarget{MainUnit_8py_source_l00064}{}\hyperlink{classELO_1_1MainUnit_1_1Factory_a515d1ff460a335b750e58e0cbddf20ae}{00064}     \textcolor{keyword}{def }\hyperlink{classELO_1_1MainUnit_1_1Factory_a515d1ff460a335b750e58e0cbddf20ae}{runLogin}(self, request, entity):
00065         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a189a44a11e1a66ba69663eb2c598dd7c}{\_\_ui}, IfUiLogin):
00066             self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a68f6640ad3b515e1b8cd48d1554c0779}{\_\_pers} = \hyperlink{classLogin_1_1LoginUnit_1_1PersLogin}{PersLogin}()
00067             self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a6a0b7b93046e095779ba54e0a8a4d02c}{\_\_bus} = \hyperlink{classLogin_1_1LoginUnit_1_1BusLogin}{BusLogin}(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a68f6640ad3b515e1b8cd48d1554c0779}{\_\_pers})
00068             self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a189a44a11e1a66ba69663eb2c598dd7c}{\_\_ui} = \hyperlink{classLogin_1_1LoginUnit_1_1UiLogin}{UiLogin}(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a6a0b7b93046e095779ba54e0a8a4d02c}{\_\_bus})
00069 
00070         \textcolor{keywordflow}{if} entity == \textcolor{stringliteral}{"Adm"}:
00071             database = Adm
00072         \textcolor{keywordflow}{elif} entity == \textcolor{stringliteral}{"God"}:
00073             database = God
00074         \textcolor{keywordflow}{elif} entity == \textcolor{stringliteral}{"Professor"}:
00075             database = Professor
00076         \textcolor{keywordflow}{elif} entity == \textcolor{stringliteral}{"Student"}:
00077             database = Student
00078         \textcolor{keywordflow}{else}:
00079             database = \textcolor{keywordtype}{None}
00080 
00081         \textcolor{keywordflow}{return} self.\_\_ui.run(request, database)
00082 
00083     \textcolor{comment}{## Classe que executa o logout.}
00084     \textcolor{comment}{#   Finaliza a sessão do usuário e redireciona para }
00085     \textcolor{comment}{#   a página de login.}
\hypertarget{MainUnit_8py_source_l00086}{}\hyperlink{classELO_1_1MainUnit_1_1Factory_aa26c51486ba65030399897a6e3b4f4f1}{00086}     \textcolor{keyword}{def }\hyperlink{classELO_1_1MainUnit_1_1Factory_aa26c51486ba65030399897a6e3b4f4f1}{runLogout}(self, request):
00087         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'user'} \textcolor{keywordflow}{in} request.session.keys():
00088             del request.session[\textcolor{stringliteral}{'user'}]
00089             del request.session[translation.LANGUAGE\_SESSION\_KEY]
00090         \textcolor{keywordflow}{return} self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a515d1ff460a335b750e58e0cbddf20ae}{runLogin}(request, \textcolor{stringliteral}{"Student"})
00091 
00092     \textcolor{comment}{## Classe que executa a página inicial do módulo de Perfil.}
00093     \textcolor{comment}{#   Define as camadas de persistência, negócio e apresentação de}
00094     \textcolor{comment}{#   perfil e proíbe o acesso de usuários não logados no sistema.}
00095     \textcolor{comment}{#}
00096     \textcolor{comment}{#   @arg acctype    Define o tipo de acesso que o usuário está requerindo.}
00097     \textcolor{comment}{#                   "Full": Acessa o Perfil completo, com possibilidade de}
00098     \textcolor{comment}{#                       edição. Caso a chamada seja assíncrona, retorna a}
00099     \textcolor{comment}{#                       form de edição do campo específico.}
00100     \textcolor{comment}{#                   "Home": Acessa o Perfil resumido, a home do site em si.}
00101     @method\_decorator(vary\_on\_cookie)
00102     @method\_decorator(csrf\_protect)
\hypertarget{MainUnit_8py_source_l00103}{}\hyperlink{classELO_1_1MainUnit_1_1Factory_ab20a76f74180fc77c6b8fcd8de7942f1}{00103}     \textcolor{keyword}{def }\hyperlink{classELO_1_1MainUnit_1_1Factory_ab20a76f74180fc77c6b8fcd8de7942f1}{runProfile}(self, request, acctype, field=None):
00104         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'user'} \textcolor{keywordflow}{in} request.session.keys(): \textcolor{comment}{# is user logged?}
00105             user\_type = request.session[\textcolor{stringliteral}{'user'}][\textcolor{stringliteral}{'type'}]
00106             \textcolor{keywordflow}{if} user\_type == \textcolor{stringliteral}{'Professor'} \textcolor{keywordflow}{or} user\_type == \textcolor{stringliteral}{'Student'}:
00107                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a189a44a11e1a66ba69663eb2c598dd7c}{\_\_ui}, IfUiProfile):
00108                     self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a68f6640ad3b515e1b8cd48d1554c0779}{\_\_pers} = \hyperlink{classProfile_1_1ProfileUnit_1_1PersProfile}{PersProfile}()
00109                     self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a6a0b7b93046e095779ba54e0a8a4d02c}{\_\_bus} = \hyperlink{classProfile_1_1ProfileUnit_1_1BusProfile}{BusProfile}(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a68f6640ad3b515e1b8cd48d1554c0779}{\_\_pers})
00110                 \textcolor{keywordflow}{if} acctype == \textcolor{stringliteral}{"Full"}:
00111                     self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a189a44a11e1a66ba69663eb2c598dd7c}{\_\_ui} = \hyperlink{classProfile_1_1ProfileUnit_1_1UiFullProfile}{UiFullProfile}(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a6a0b7b93046e095779ba54e0a8a4d02c}{\_\_bus})
00112                 \textcolor{keywordflow}{elif} acctype == \textcolor{stringliteral}{"Home"}:
00113                     self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a189a44a11e1a66ba69663eb2c598dd7c}{\_\_ui} = \hyperlink{classProfile_1_1ProfileUnit_1_1UiHomeProfile}{UiHomeProfile}(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a6a0b7b93046e095779ba54e0a8a4d02c}{\_\_bus})
00114                 \textcolor{keywordflow}{else}:
00115                     \textcolor{keywordflow}{raise} Http404(lang.DICT[\textcolor{stringliteral}{"EXCEPTION\_404\_ERR"}])
00116             
00117                 \textcolor{keywordflow}{if} field \textcolor{keywordflow}{and} acctype == \textcolor{stringliteral}{"Full"}:
00118                     \textcolor{keywordflow}{return} self.\_\_ui.run(request, field)
00119                 \textcolor{keywordflow}{else}:
00120                     \textcolor{keywordflow}{return} self.\_\_ui.run(request)
00121             \textcolor{keywordflow}{else}:
00122                 \textcolor{keywordflow}{raise} Http404(lang.DICT[\textcolor{stringliteral}{"EXCEPTION\_404\_ERR"}])
00123         \textcolor{keywordflow}{else}:
00124             \textcolor{keywordflow}{raise} PermissionDenied(lang.DICT[\textcolor{stringliteral}{"EXCEPTION\_403\_STD"}])
00125         
00126 
00127     \textcolor{comment}{## Classe que executa o módulo de Administração.}
00128     \textcolor{comment}{#   Define as camadas de persinstência, negócio e apresentação de}
00129     \textcolor{comment}{#   administração.}
00130     @method\_decorator(vary\_on\_cookie)
00131     @method\_decorator(csrf\_protect)
\hypertarget{MainUnit_8py_source_l00132}{}\hyperlink{classELO_1_1MainUnit_1_1Factory_a533b402a54bf6f6715824a8687fa7a24}{00132}     \textcolor{keyword}{def }\hyperlink{classELO_1_1MainUnit_1_1Factory_a533b402a54bf6f6715824a8687fa7a24}{runAdm}(self, request, action=None, model=None):
00133         \textcolor{comment}{# Checa se usuario ja esta logado}
00134         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'user'} \textcolor{keywordflow}{in} request.session.keys():
00135             if(request.session[\textcolor{stringliteral}{'user'}][\textcolor{stringliteral}{'type'}] == \textcolor{stringliteral}{'Adm'} \textcolor{keywordflow}{or}
00136                request.session[\textcolor{stringliteral}{'user'}][\textcolor{stringliteral}{'type'}] == \textcolor{stringliteral}{'God'}):
00137                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a189a44a11e1a66ba69663eb2c598dd7c}{\_\_ui}, IfUiAdm):
00138                     self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a68f6640ad3b515e1b8cd48d1554c0779}{\_\_pers} = \hyperlink{classAdm_1_1AdmUnit_1_1PersAdm}{PersAdm}()
00139                     self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a6a0b7b93046e095779ba54e0a8a4d02c}{\_\_bus} = \hyperlink{classAdm_1_1AdmUnit_1_1BusAdm}{BusAdm}(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a68f6640ad3b515e1b8cd48d1554c0779}{\_\_pers})
00140                     self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a189a44a11e1a66ba69663eb2c598dd7c}{\_\_ui} = \hyperlink{classAdm_1_1AdmUnit_1_1UiAdm}{UiAdm}(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a6a0b7b93046e095779ba54e0a8a4d02c}{\_\_bus}) 
00141                 
00142                 \textcolor{keywordflow}{if} action != \textcolor{keywordtype}{None} \textcolor{keywordflow}{and} model != \textcolor{keywordtype}{None}:
00143                     \textcolor{keywordflow}{return} self.\_\_ui.run(request, action)
00144                 
00145                 \textcolor{keywordflow}{return} self.\_\_ui.run(request)
00146         \textcolor{keywordflow}{raise} PermissionDenied(lang.DICT[\textcolor{stringliteral}{"EXCEPTION\_403\_STD"}])
00147 
00148     \textcolor{comment}{## Classe que executa o módulo de Curso.}
00149     \textcolor{comment}{#   Define as camadas de persistência, negócio e apresentação de}
00150     \textcolor{comment}{#   curso.}
00151     @method\_decorator(vary\_on\_cookie)
00152     @method\_decorator(csrf\_protect)
\hypertarget{MainUnit_8py_source_l00153}{}\hyperlink{classELO_1_1MainUnit_1_1Factory_a5e360bc5396fd576e0614b9e157b3816}{00153}     \textcolor{keyword}{def }\hyperlink{classELO_1_1MainUnit_1_1Factory_a5e360bc5396fd576e0614b9e157b3816}{runCourse}(self, request, courseid=None):
00154         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'user'} \textcolor{keywordflow}{in} request.session.keys():
00155             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a189a44a11e1a66ba69663eb2c598dd7c}{\_\_ui} \textcolor{keywordflow}{is} IfUiCourse:
00156                 self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a68f6640ad3b515e1b8cd48d1554c0779}{\_\_pers} = \hyperlink{classCourse_1_1CourseUnit_1_1PersCourse}{PersCourse}()
00157                 self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a6a0b7b93046e095779ba54e0a8a4d02c}{\_\_bus} = \hyperlink{classCourse_1_1CourseUnit_1_1BusCourse}{BusCourse}(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a68f6640ad3b515e1b8cd48d1554c0779}{\_\_pers})
00158                 self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a189a44a11e1a66ba69663eb2c598dd7c}{\_\_ui} = \hyperlink{classCourse_1_1CourseUnit_1_1UiCourse}{UiCourse}(self.\hyperlink{classELO_1_1MainUnit_1_1Factory_a6a0b7b93046e095779ba54e0a8a4d02c}{\_\_bus})
00159 
00160             \textcolor{keywordflow}{return} self.\_\_ui.run(request, courseid)
00161         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'runCourse('} +str(self)+\textcolor{stringliteral}{','}+str(request)+\textcolor{stringliteral}{',courseid='}+str(courseid)
00162         \textcolor{keywordflow}{raise} PermissionDenied(lang.DICT[\textcolor{stringliteral}{"EXCEPTION\_403\_STD"}])
\end{DoxyCode}
